{% extends "topindex.html"%}
{% block head %}
{{super()}}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>

Vue.component('problem-button', {
	delimiters: ["!!!", "!!!"],
	data: function () {
		return {
			Button: this.unique_id 
		}
	},
	methods: {
		do_thing: function(variable) {
			insert_modal(variable)	
		}

	},
	props: ['unique_id'],
	template: '<button v-on:click="do_thing(Button)" class="btn btn-primary">!!! Button !!!</button>',
});



Vue.component('modal-maker',{
		delimiters: ['!!!','!!!'],
		data: function() {
			return {
				items: [],
				name: null,
				summary: null,
			}
		},
		
		props: ['unique_id'],

		template: `
					
<div id="problem-modal" class="modal fade"  tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">!!! name !!!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        !!! summary !!!
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>
</div>
	
		`,
		
		created: function() {
			this.fetchData(this.button_id);
		},
		
		methods: {
			fetchData: function(button_id) {
				var self = this;
				fetch('./api/problems')
					.then(response => {
						var response = response.json();
						return response;
					})
					.then(json => {
						var data = json.data;
						var length = data.length;
						for (var i = 0; i<length; i++) {
							if (data[i].unique_id == button_id) {
								this.name = data[i].problem_name;
								this.summary = data[i].summary;
							}
						}
					})
				}
			},	
		});

function insert_modal(unique_id) {
	document.getElementById('modal-div').innerHTML = `<modal-maker id='modal-div${unique_id}' unique_id=${unique_id}></modal-maker>`;
	new Vue({ el: `#modal-div${unique_id}` })	
}


</script>

<style>
			* {
				box-sizing: border-box;
			}
			html, body {
				margin: 0;
				padding: 0;
				font-family: sans-serif;
				font-size: 1.1em;
				text-align: center;
			}
			.sidebar,
			.content {
				padding: 10px;
			}

			.sidebar {
				background: #F34A4E;
			}
			.main-container{
				display: grid;
				grid-template:
					[row1-start] "left right" auto[row1-end]
					/ 20% auto;
					padding: 20px;
					
			}
			
			.left {
				background: #F34A4E;
				grid-area: left;
			}
			
			.right {
				grid-area: right;
			}
		
			.container-asdf {
				display: grid;
				grid-template:
					[row1-start] "title button" auto[row1-end]
					[row2-start] "content button" auto[row2-end]
					/ 90% auto;
				<!--outline-style: solid;
				outline-color: black; -->
			    word-wrap: break-word;
				word-break: break-all;
				padding: 20px;
				border-bottom:3px solid #f5f5f5;
			}
			.item-a {
				grid-area: title;
				place-self: start;
				font-weight: bold;
				color: black;
			}
			.item-b {
				grid-area: content;
				place-self: start;
				font-size: .7em;
				padding-left: .5in;
			}
			.item-c {
				grid-area: button;
				place-self: center;
				font-size: 2em
			}
			
		

			@media screen and (min-width: 768px) { 
				.modal:before {
					display: inline-block;
					vertical-align: middle;
					content: " ";
					height: 100%;
				}
			}

</style>
{%endblock%}
{%block content%}
<body>


<div id="app" class="main-container">
	<div class="left sidebar">
	Under Construction
	</div>
	<div class="right">
	{% with messages = get_flashed_messages() %}
	{% if messages %}
	{% for record in messages %}
			{% for problem in record %}
				
				<div class="container-asdf">
					<div class="item-a">{{ problem.problem_name }}</div>
					<div class="item-b">{{ problem.summary }}</div>
					<div class="item-c" id="item-c{{problem.unique_id}}">
						<problem-button unique_id='{{ problem.unique_id }}'></problem-button>
					</div>
					<script>new Vue({ el: "#item-c{{problem.unique_id}}"}) </script>
				</div>
				
			{% endfor %}
		{% endfor %}
	{% endif %}
	{% endwith %}
	</div>
</div>
<div id="modal-div">
</div>
</body>
{%endblock%}

